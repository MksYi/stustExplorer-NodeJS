$(document).ready(function(){function m(a,b){$(".auto-result").off("click",p);if(a&&0<a.length){var d=n.lastIndexOf(a[0]);if(0<=d||b)n.splice(d,1),c=0,f=a,d={results:a.slice(1)},g.html(u(d));$(".auto-result").on("click",p)}else g.html("")}function q(){f&&(b.val(f[c]),g.find(".auto-result").each(function(a){var b=$(this);c===a+1?b.addClass("selected"):b.removeClass("selected")}))}function v(a){n.push(a);0===a.length?m([""],!0):$.getJSON("/api?search="+encodeURIComponent(a),function(b){for(var c=[a],
d=0;d<b[1].length;d++)c.push(b[1][d]);m(c)}).fail(function(){m()})}function h(a){var c=a;"string"!==typeof a&&(c=b.val().replace(/\s+/g," "));v(c);!1===k&&0<c.length&&(e.addClass("auto"),k=!0)}function l(){!0===k&&(b.focus(),e.removeClass("auto"),k=!1)}function p(){if(!0!==$(this).data("invalid")){var a=$(this).text();b.val(a);l()}}function r(){b.val("");l()}var e=$("#search"),b=e.find("#search-input"),w=e.find("#search-clear"),g=e.find("#search-complete");$("#failed");var x=g.find("#complete-template").html(),
u=Handlebars.compile(x),n=[],c=0,f,k=!1,t="";b.on("keypress",function(a){13==a.keyCode&&(a=b.val().replace(/\s+/g," "),0<a.length&&window.open("/search?action="+encodeURIComponent(a)),r())});b.on("keyup",function(a){switch(a.which){case 38:0>=c&&(c=f.length);b.val();c--;q();a.preventDefault();break;case 40:c++;c>=f.length&&(c=0);q();a.preventDefault();break;default:a=b.val().replace(/\s+/g," "),t!==a&&(t=a,0<a.length?h(a):(h(""),l()))}});b.on("focus",h);b.on("blur",l);e.on("focusin",h);w.on("click",
r)});