$(document).ready(function(){function m(a,b){$(".auto-result").off("click",p);if(a&&0<a.length){var d=n.lastIndexOf(a[0]);if(0<=d||b)n.splice(d,1),c=0,f=a,d={results:a.slice(1)},h.html(t(d));$(".auto-result").on("click",p)}else h.html("")}function q(){f&&(b.val(f[c]),h.find(".auto-result").each(function(a){var b=$(this);c===a+1?b.addClass("selected"):b.removeClass("selected")}))}function u(a){n.push(a);0===a.length?m([""],!0):$.getJSON("/api?search="+encodeURIComponent(a),function(b){for(var c=[a],
d=0;d<b[1].length;d++)c.push(b[1][d]);m(c)}).fail(function(){m()})}function k(a){var c=a;"string"!==typeof a&&(c=b.val().replace(/\s+/g," "));u(c);!1===l&&0<c.length&&(e.addClass("auto"),l=!0)}function g(){!0===l&&(b.focus(),e.removeClass("auto"),l=!1)}function p(){if(!0!==$(this).data("invalid")){var a=$(this).text();b.val(a);g()}}var e=$("#search"),b=e.find("#search-input"),v=e.find("#search-clear"),h=e.find("#search-complete");$("#failed");var w=h.find("#complete-template").html(),t=Handlebars.compile(w),
n=[],c=0,f,l=!1,r="";b.on("keypress",function(a){13==a.keyCode&&(a=b.val().replace(/\s+/g," "),0<a.length&&window.open("/search?action="+encodeURIComponent(a)),g())});b.on("keyup",function(a){switch(a.which){case 38:0>=c&&(c=f.length);b.val();c--;q();a.preventDefault();break;case 40:c++;c>=f.length&&(c=0);q();a.preventDefault();break;default:a=b.val().replace(/\s+/g," "),r!==a&&(r=a,0<a.length?k(a):(k(""),g()))}});b.on("focus",k);b.on("blur",g);e.on("focusin",k);v.on("click",function(){b.val("");
g()})});